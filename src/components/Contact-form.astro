---
import { Image } from "astro:assets";
import msgMe from "../assets/msgMe.png";
---

<div class="flex items-center text-sm">
  <div class="">
    <h2
      class="text-4xl uppercase md:capitalize md:text-8xl xl:text-9xl font-extrabold text-white opacity-20 md:opacity-10 mb-4 md:mb-8 xl:mb-20"
    >
      Let's Talk.
    </h2>
    <p class="mb-8 md:w-[85%]">
      Iâ€™m interested in hearing from you to collaborate or discuss about any
      freelance opportunities - especially those centered around solving human
      problems. Do not hesitate to use the form below to reach out.
    </p>
    <form>
      <input
        class="h-12 md:h-16 w-full bg-[#3A3A3A] mb-4 xl:mb-8 rounded-md p-4 md:p-6 hover:border-2 border-main active:border-2 focus:border-2 outline-none"
        type="email"
        name="email"
        placeholder="Email"
        required
      />
      <textarea
        class="w-full bg-[#3A3A3A] mb-4 md:mb-16 p-4 md:p-6 t h-28 md:h-40 hover:border-2 border-main active:border-2 focus:border-2 outline-none"
        name="msg"
        required
        placeholder="Message Content"></textarea>
      <button
        type="submit"
        id="mailBtn"
        class="inline-block box-border bg-none py-3 px-6 border-2 md:border-[3px] rounded-lg shadow-md shadow-neutral-900 border-sec text-sec md:font-semibold hover:shadow-none hover:border-sec active:border-sec focus:border-sec hover:bg-sec active:bg-sec focus:bg-sec hover:text-white active:text-white focus:text-white"
        >Message me</button
      >
    </form>
  </div>
  <div class="hidden lg:flex w-full">
    <Image class="w-[93%] scale-[1.2]" src={msgMe} alt="message me" />
  </div>
</div>

<script>
  import emailjs from "@emailjs/browser";

  document.addEventListener("DOMContentLoaded", () => {
    const form = document.querySelector("form");
    const mailBtn = document.querySelector("#mailBtn");
    form?.addEventListener("submit", async (event) => {
      event.preventDefault();

      const clientEmail = event.target["email"]?.value;
      const message = event.target["msg"]?.value;

      try {
        mailBtn.disabled = true;
        mailBtn.innerText = "Sending ...";
        const response = await emailjs.send(
          `${import.meta.env.PUBLIC_SERVICE_ID}`,
          `${import.meta.env.PUBLIC_TEMPLATE_ID}`,
          {
            client_email: clientEmail,
            message: message,
          },
          { publicKey: `${import.meta.env.PUBLIC_KEY}` }
        );

        console.log("SUCCESS!", response.status, response.text);
        mailBtn.innerText = "Message Sent âœ…";
      } catch (error) {
        console.error("FAILED...", error);
        mailBtn.disabled = false;
        mailBtn.innerText = "Sending Failed, Click to Resend ðŸ”ƒ";
      }
    });
  });
</script>
